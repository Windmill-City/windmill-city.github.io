<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CubeMX + SCons 闪灯实验 | 明理</title>
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="CubeMX + SCons 闪灯实验">
<meta name="author" content="Windmill-City">
<meta property="og:locale" content="en_US">
<meta name="description" content="Environment">
<meta property="og:description" content="Environment">
<link rel="canonical" href="https://windmill-city.github.io//stm32/scons/2022/09/20/%E9%97%AA%E7%81%AF.html">
<meta property="og:url" content="https://windmill-city.github.io//stm32/scons/2022/09/20/%E9%97%AA%E7%81%AF.html">
<meta property="og:site_name" content="明理">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-09-20T00:00:00+08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="CubeMX + SCons 闪灯实验">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Windmill-City"},"dateModified":"2023-01-29T15:19:09+08:00","datePublished":"2022-09-20T00:00:00+08:00","description":"Environment","headline":"CubeMX + SCons 闪灯实验","mainEntityOfPage":{"@type":"WebPage","@id":"https://windmill-city.github.io//stm32/scons/2022/09/20/%E9%97%AA%E7%81%AF.html"},"url":"https://windmill-city.github.io//stm32/scons/2022/09/20/%E9%97%AA%E7%81%AF.html"}</script>
<!-- End Jekyll SEO tag -->


    <!--CSS Style Sheets-->
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/font-awesome-4.7.0/css/font-awesome.css">
    <link href="/assets/css/viewer.css" rel="stylesheet">
    <!--favicon-->
    <link rel="icon" href="/assets/img/favicon.ico">
    <!--js-->
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/viewer.js"></script>
    <script src="/assets/js/jquery-viewer.js"></script>
    <script>
        let Viewer;
        $(document).ready(function () {
            Viewer = $("#page-content").viewer();
        })
    </script>
</head>

<body>
    <div id="nav-aside">
    <ul>
        <!--Home page-->
        <li id="home"><a href="/">明理</a></li>
        <!--Table of Pages-->
        <ul id="pages">
<li><a href="/category/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/">个人网站</a></li>
<li><a href="/category/stm32/">STM32</a></li>
<li><a href="/category/scons/">SCons</a></li>
<li><a href="/category/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/">图形界面</a></li>
</ul>
        <!--Table of Posts-->
        <ul id="posts">
            
            
            <li><a href="/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/2023/01/29/%E4%BD%BF%E7%94%A8GLFW%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3.html">使用GLFW构建一个窗口</a></li>
            
            
            
            <li><a href="/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/2023/01/29/Nuklear%E5%85%A5%E9%97%A8.html">Nuklear入门</a></li>
            
            
            
            <li><a class="active" href="#top">CubeMX + SCons 闪灯实验</a></li>
            <ul id="toc">
<li>
<a href="#environment">Environment</a><ul>
<li><a href="#python">Python</a></li>
<li><a href="#scons">SCons</a></li>
<li><a href="#toolchain">Toolchain</a></li>
<li><a href="#pyocd">PyOCD</a></li>
<li><a href="#cubemx">CubeMX</a></li>
</ul>
</li>
<li>
<a href="#%E7%94%9F%E6%88%90%E9%A1%B9%E7%9B%AE">生成项目</a><ul>
<li><a href="#pin--configuration">Pin &amp; Configuration</a></li>
<li>
<a href="#project-manager">Project Manager</a><ul>
<li><a href="#project">Project</a></li>
<li><a href="#code-generator">Code Generator</a></li>
<li><a href="#generate-code">Generate Code</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#build">Build</a><ul><li><a href="#glob">Glob</a></li></ul>
</li>
</ul>
            
            
            
            <li><a href="/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/2022/09/13/%E5%AE%8C%E5%85%A8Jekyll%E5%8C%96.html">手搓 Gitbook 主题</a></li>
            
            
            
            <li><a href="/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/2022/09/12/%E5%9C%A8%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99.html">在本地测试个人网站</a></li>
            
            
            
            <li><a href="/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/2022/09/11/%E6%83%B3%E8%A6%81%E4%B8%80%E4%B8%AA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99.html">想要一个个人网站</a></li>
            
            
        </ul>
    </ul>
</div>
    <div id="nav-main">
    <!--Nav-Top-->
    <div id="nav-top">
        <a href="#top">CubeMX + SCons 闪灯实验</a>
    </div>
    <div id="nav-page">
        <!--Prev Page-->
        <div id="nav-prev">
            
            <a href="/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/2023/01/29/Nuklear%E5%85%A5%E9%97%A8.html" aria-label="Nuklear入门">
                <i id="fa fa-angle-left"></i>
            </a>
            
        </div>
        <!--Page-->
        <div id="page">
    <!--Title-->
    <h1>CubeMX + SCons 闪灯实验</h1>
    <!--Metadata-->
    <header id="meta">
        <ul>
            <!--Author-->
            <li id="author">
                Windmill-City
            </li>
            <!--Date-->
            
            <li id="date">
                2022-09-20
            </li>
            
            
            
            
            <li id="last-modified">
                2023-01-29
            </li>
            
            <!--Categories-->
            <ul id="categories">
                
                <li>
                    <a href="/category/STM32">STM32</a>
                </li>
                
                <li>
                    <a href="/category/SCons">SCons</a>
                </li>
                
            </ul>
        </ul>
    </header>
    <!--Markdown Content-->
    <section id="page-content" class="markdown-body">
        <h2 id="environment">Environment</h2>

<table>
  <thead>
    <tr>
      <th>软件</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://www.python.org/">Python</a></td>
      <td>
<code class="language-plaintext highlighter-rouge">SCons</code> <code class="language-plaintext highlighter-rouge">PyOCD</code> Runtime</td>
    </tr>
    <tr>
      <td><a href="https://www.scons.org/">SCons</a></td>
      <td>Build Tools</td>
    </tr>
    <tr>
      <td><a href="https://developer.arm.com/Tools%20and%20Software/GNU%20Toolchain">Arm GNU Toolchain</a></td>
      <td>Toolchain</td>
    </tr>
    <tr>
      <td><a href="https://github.com/pyocd/pyOCD">PyOCD</a></td>
      <td>Debug Tool</td>
    </tr>
    <tr>
      <td><a href="https://www.st.com/zh/development-tools/stm32cubemx.html">STM32CubeMX</a></td>
      <td>Debug Tool</td>
    </tr>
  </tbody>
</table>

<h3 id="python">Python</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">--version</span>
<span class="nt">---</span>
Python 3.10.5
</code></pre></div></div>

<h3 id="scons">SCons</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scons <span class="nt">-v</span>
<span class="nt">---</span>
SCons by Steven Knight et al.:
        SCons: v4.3.0.559790274f66fa55251f5754de34820a29c7327a, Tue, 16 Nov 2021 19:09:21 +0000, by bdeegan on octodog
        SCons path: <span class="o">[</span><span class="s1">'C:\\Python310\\lib\\site-packages\\SCons'</span><span class="o">]</span>
Copyright <span class="o">(</span>c<span class="o">)</span> 2001 - 2021 The SCons Foundation
</code></pre></div></div>

<h3 id="toolchain">Toolchain</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arm-none-eabi-gcc <span class="nt">-v</span>
<span class="nt">---</span>
gcc version 12.2.0 <span class="o">(</span>Arm GNU Toolchain 12.2.MPACBTI-Bet1 <span class="o">(</span>Build arm-12-mpacbti.16<span class="o">))</span>
</code></pre></div></div>

<h3 id="pyocd">PyOCD</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyocd <span class="nt">-V</span>
<span class="nt">---</span>
0.34.1
</code></pre></div></div>

<h3 id="cubemx">CubeMX</h3>

<p><img src="/assets/CubeMXVersion.png" alt="CubeMXVersion"></p>

<h2 id="生成项目">生成项目</h2>

<p><code class="language-plaintext highlighter-rouge">CubeMX</code>-&gt;<code class="language-plaintext highlighter-rouge">Access to MCU selector</code>-&gt;<code class="language-plaintext highlighter-rouge">STM32F103RCT6</code></p>

<h3 id="pin--configuration">Pin &amp; Configuration</h3>

<table>
  <tbody>
    <tr>
      <td>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">PA15</code> = <code class="language-plaintext highlighter-rouge">GPIO Output</code>
</li>
</ul>
</td>
      <td><code class="language-plaintext highlighter-rouge">Status</code></td>
    </tr>
  </tbody>
</table>

<h3 id="project-manager">Project Manager</h3>

<h4 id="project">Project</h4>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Project Name</code> = <code class="language-plaintext highlighter-rouge">firmware</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">Project Location</code> = <code class="language-plaintext highlighter-rouge">STM32Cube-Flashing</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">Toolchain / IDE</code> = <code class="language-plaintext highlighter-rouge">Makefile</code>
</li>
</ul>

<h4 id="code-generator">Code Generator</h4>

<ul>
  <li>Copy all used libraries into the project folder</li>
</ul>

<h4 id="generate-code">Generate Code</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tree
<span class="nt">---</span>
STM32Cube-Flashing
└─firmware
    ├─Core
    │  ├─Inc
    │  └─Src
    └─Drivers
</code></pre></div></div>

<h2 id="build">Build</h2>

<p><a href="https://stackoverflow.com/questions/55848516/unable-to-cross-compile-for-arm-with-scons-because-fo-is-added">Unable to cross compile for ARM with Scons because /Fo is added</a></p>

<p>需要指定构建环境用到的工具
<a href="https://www.scons.org/doc/production/HTML/scons-user.html#app-tools">Appendix C. Tools</a></p>

<p><code class="language-plaintext highlighter-rouge">SConstruct</code></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s">'gcc'</span><span class="p">,</span> <span class="s">'g++'</span><span class="p">,</span> <span class="s">'gnulink'</span><span class="p">,</span> <span class="s">'ar'</span><span class="p">,</span> <span class="s">'as'</span><span class="p">])</span>
</code></pre></div></div>

<p>依照 <code class="language-plaintext highlighter-rouge">Makefile</code> 的内容配置 <code class="language-plaintext highlighter-rouge">Environment</code></p>

<p><code class="language-plaintext highlighter-rouge">Working Directory</code> = <code class="language-plaintext highlighter-rouge">firmware</code></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scons
<span class="nt">---</span>
scons: <span class="k">done </span>building targets.
</code></pre></div></div>

<h3 id="glob">Glob</h3>

<p><a href="http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html">阮一峰-命令行通配符教程</a></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C_Src_Dirs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'Core/Src'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">C_Glob_Srcs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_dir</span> <span class="ow">in</span> <span class="n">C_Src_Dirs</span><span class="p">:</span>
    <span class="n">C_Sources</span> <span class="o">+=</span> <span class="n">Glob</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">_dir</span><span class="si">}</span><span class="s">/*.c'</span><span class="p">)</span>
</code></pre></div></div>

<p>使用 <code class="language-plaintext highlighter-rouge">Glob</code> 简化多文件编译</p>

    </section>
</div>
        <!--Next Page-->
        <div id="nav-next">
            
            <a href="/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/2022/09/13/%E5%AE%8C%E5%85%A8Jekyll%E5%8C%96.html" aria-label="手搓 Gitbook 主题">
                <i class="fa fa-angle-right"></i>
            </a>
            
        </div>
    </div>
</div>
</body>

</html>
